{% extends 'layout_dashboard.html' %}
{% load static %}
{% block content %}

<head>
	<link href="{% static 'css/trip.css' %}" rel="stylesheet">
</head>
<!-- <style type="text/css">
	#map{
		height:500px;
		width: 500px;
		
	}
</style> -->
<div class="container">
	
	<div class="card">
	  <div class="card-body">

	    <h4 class="card-title">Trip History</h4>
	    {% if trip_info.query %}
		<b>Trip #{{ trip_info.trip_number }} </b> on {{ trip_info.datetime }}
	    {% else %}
	    <b>Most Recent Trip</b> on {{ trip_info.datetime }}
	    {% endif %}
	    <p class="card-text">
	      <div id="map"> </div>
	    </p>
	    <!-- <a href="#!" class="card-link">Card link</a>
	    <a href="#!" class="card-link">Another link</a> -->
	  </div>
	  	<div class="card-footer">
    		<h4>Select Trip Number:</h4> 
		{% for item in trip %}
			<form action="{% url 'device-trip' item.device_IMEI %}" method="get" name="TripForm">
			{% endfor %}
			    <select name="trip_number" onchange="TripForm.submit()">
			    	 <option value="" selected disabled hidden>Choose here</option>
			        {% for num in distinct_trip %}
			        <option value="{{num.trip_number}}">{{num.trip_number}}</option>
			       	{% endfor %}
			    </select>
			    
			   <!--  <input type="submit" value="Filter" /> -->
			</form>
  		</div>
	</div>


	

	

	
	
</div>

<script type="text/javascript">
	var dict_list = [];
	{% for item in trip %}
	 // create an empty array

		dict_list.push({
		    lat: {{item.lat}},
		    lng: {{item.lng}}
		});
	{% endfor %}
	console.log(dict_list)
</script>
<script type="text/javascript">
	function initMap() {
	  var map = new google.maps.Map(document.getElementById('map'), {
	    zoom: 15,
	    center: {lat: 32.877679, lng: -117.214136},
	    mapTypeId: 'terrain'
	  });

	  var flightPath = new google.maps.Polyline({
	    path: dict_list,
	    geodesic: true,
	    strokeColor: '#FF0000',
	    strokeOpacity: 1.0,
	    strokeWeight: 3
	  });
	  // var markers = [];//some array
	  var bounds = new google.maps.LatLngBounds ();
	  for (var i = 0, LtLgLen = dict_list.length; i < LtLgLen; i++) {
	    //  And increase the bounds to take this point
	    bounds.extend (dict_list[i]);
	  }
	  //  Fit these bounds to the map
	  map.fitBounds (bounds);
	  
	  flightPath.setMap(map);

	}
</script>

<script async defer
    src="https://maps.googleapis.com/maps/api/js?key=AIzaSyD9Lg54i0EXC09HSeRSBF9OWXLdDEKNjmU&callback=initMap">
</script>
{% endblock %}